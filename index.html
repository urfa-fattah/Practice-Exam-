<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OMR Master Pro | Urfa Hasan Fattah</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body { 
        font-family: 'Plus Jakarta Sans', sans-serif; 
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        color: #0f172a;
        min-height: 100vh;
      }
      
      /* Glassmorphism Classes */
      .glass {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      
      .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(16px);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.6);
        border-radius: 1.5rem;
      }

      /* Animations */
      .fade-enter { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
      
      /* Tooltip Animation */
      .tooltip-content {
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.2s, transform 0.2s;
        transform: translateY(5px);
      }
      .group:hover .tooltip-content {
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
      ::-webkit-scrollbar-track { background: transparent; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      // --- ICONS ---
      const IconWrapper = ({ children, size = 20, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
          {children}
        </svg>
      );

      const Icons = {
        Info: (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></IconWrapper>,
        Settings: (p) => <IconWrapper {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>,
        Clock: (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>,
        Zap: (p) => <IconWrapper {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconWrapper>,
        AlertTriangle: (p) => <IconWrapper {...p}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconWrapper>,
        BarChart: (p) => <IconWrapper {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></IconWrapper>,
        Check: (p) => <IconWrapper {...p}><polyline points="20 6 9 17 4 12"/></IconWrapper>,
        X: (p) => <IconWrapper {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconWrapper>,
        Facebook: (p) => <IconWrapper {...p}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></IconWrapper>,
        Send: (p) => <IconWrapper {...p}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></IconWrapper>,
        ChevronRight: (p) => <IconWrapper {...p}><polyline points="9 18 15 12 9 6"/></IconWrapper>,
        Timer: (p) => <IconWrapper {...p}><path d="M10 2h4"/><path d="M12 14v-4"/><path d="M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6"/><path d="M9 17H4v5"/></IconWrapper>
      };

      // --- REUSABLE UI COMPONENTS ---

      // The "Description Icon" Tooltip
      const Tooltip = ({ text }) => (
        <div className="group relative inline-block ml-1 align-super cursor-help z-50">
           <span className="text-blue-400 hover:text-blue-600 transition-colors">
              <Icons.Info size={12} />
           </span>
           <div className="tooltip-content absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-slate-800 text-white text-xs rounded-lg shadow-xl text-center z-50 pointer-events-none">
              {text}
              <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800"></div>
           </div>
        </div>
      );

      const Card = ({ children, className = "" }) => (
        <div className={`glass-card p-6 ${className}`}>{children}</div>
      );

      const Button = ({ onClick, variant = "primary", className = "", children, ...props }) => {
        const base = "px-6 py-3 rounded-xl font-bold transition-all duration-200 flex items-center justify-center gap-2 transform active:scale-95";
        const styles = {
          primary: "bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200 hover:shadow-blue-300",
          secondary: "bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 hover:border-slate-300",
          danger: "bg-rose-500 text-white hover:bg-rose-600 shadow-lg shadow-rose-200",
          success: "bg-emerald-500 text-white hover:bg-emerald-600 shadow-lg shadow-emerald-200"
        };
        return <button onClick={onClick} className={`${base} ${styles[variant]} ${className}`} {...props}>{children}</button>;
      };

      // --- LOGIC & STORAGE ---
      const OMR_OPTIONS = ['A', 'B', 'C', 'D', 'E'];
      const STORAGE_KEY = 'omr_master_v3_pro'; 

      const loadResults = () => {
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } 
        catch (e) { return []; }
      };

      const saveResults = (results) => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(results));
      };

      const calculateScore = (answers, key, pos, neg, timeTaken) => {
        let correct = 0, incorrect = 0, unattempted = 0;
        let mistakes = [];

        answers.forEach((ans, i) => {
          const status = key[i];
          if (status === 'correct') correct++;
          else if (status === 'incorrect') {
            incorrect++;
            mistakes.push(i + 1);
          } else unattempted++;
        });

        const rawScore = (correct * pos) - (incorrect * neg);
        const attempted = correct + incorrect;
        
        return { 
          score: parseFloat(rawScore.toFixed(2)), 
          correct, incorrect, unattempted, mistakes,
          totalQuestions: answers.length, 
          timeTakenSeconds: timeTaken,
          accuracy: attempted ? Math.round((correct / attempted) * 100) : 0,
          avgTimePerQ: attempted ? (timeTaken / attempted).toFixed(1) : 0
        };
      };

      // --- CHARTS (SVG) ---
      const LineChart = ({ data, dataKey, color, label }) => {
        if (!data || data.length < 2) return <div className="h-32 flex items-center justify-center text-slate-400 text-sm italic bg-slate-50 rounded-xl">Play at least 2 exams to see {label} trends</div>;

        const vals = data.map(d => d[dataKey]);
        const max = Math.max(...vals, 1);
        const min = Math.min(...vals);
        const range = max - min || 1;
        const h = 100, w = 300, p = 10; // height, width, padding

        const points = data.map((d, i) => {
           const x = p + (i / (data.length - 1)) * (w - 2 * p);
           const y = h - p - ((d[dataKey] - min) / range) * (h - 2 * p);
           return `${x},${y}`;
        }).join(" ");

        return (
           <div className="w-full h-40 relative">
              <svg viewBox={`0 0 ${w} ${h}`} className="w-full h-full overflow-visible">
                 <polyline points={points} fill="none" stroke={color} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="drop-shadow-md"/>
                 {data.map((d, i) => {
                    const x = p + (i / (data.length - 1)) * (w - 2 * p);
                    const y = h - p - ((d[dataKey] - min) / range) * (h - 2 * p);
                    return <circle key={i} cx={x} cy={y} r="4" fill="white" stroke={color} strokeWidth="2" />
                 })}
              </svg>
           </div>
        );
      };

      // --- SCREENS ---

      // 1. SETUP & DASHBOARD
      const SetupScreen = ({ onStart, savedResults }) => {
        const [tab, setTab] = useState('new');
        const [config, setConfig] = useState({ name: '', q: 20, opt: 4, time: 30, pos: 4, neg: 1 });

        const handleStart = () => {
           if (!config.name.trim() || config.q < 1) return alert("Please check your exam inputs.");
           onStart({ ...config, name: config.name || `Practice Test #${savedResults.length + 1}` });
        };

        return (
          <div className="max-w-5xl mx-auto px-4 py-8 fade-enter">
            <header className="text-center mb-10">
               <h1 className="text-4xl font-extrabold text-slate-800 mb-2 tracking-tight">OMR Master <span className="text-blue-600">Pro</span></h1>
               <p className="text-slate-500 font-medium">Professional Practice & Analytics Suite</p>
            </header>

            <div className="flex justify-center mb-8">
               <div className="bg-white p-1.5 rounded-2xl shadow-sm border border-slate-200 inline-flex">
                  <button onClick={() => setTab('new')} className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${tab === 'new' ? 'bg-slate-900 text-white shadow-lg' : 'text-slate-500 hover:text-slate-700'}`}>New Exam</button>
                  <button onClick={() => setTab('analytics')} className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all flex gap-2 items-center ${tab === 'analytics' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-700'}`}>
                     <Icons.BarChart size={16}/> Analytics Center
                  </button>
               </div>
            </div>

            {tab === 'new' ? (
               <Card className="max-w-xl mx-auto border-t-4 border-t-blue-600">
                  <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                     <Icons.Settings className="text-blue-600"/> Configure Exam
                  </h2>
                  
                  <div className="space-y-5">
                     <div>
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">
                           Exam Name <Tooltip text="Give your exam a unique name to track it separately in analytics (e.g. 'Physics Ch 1')." />
                        </label>
                        <input type="text" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-semibold focus:ring-2 focus:ring-blue-500 outline-none transition" 
                               placeholder="e.g. Biology Full Mock 1" 
                               value={config.name} onChange={e=>setConfig({...config, name: e.target.value})} />
                     </div>
                     
                     <div className="grid grid-cols-2 gap-5">
                        <div>
                           <label className="block text-xs font-bold text-slate-500 uppercase mb-1">
                              Questions (N) <Tooltip text="Total number of questions in the test paper." />
                           </label>
                           <input type="number" min="1" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold" 
                                  value={config.q} onChange={e=>setConfig({...config, q: e.target.value})}/>
                        </div>
                        <div>
                           <label className="block text-xs font-bold text-slate-500 uppercase mb-1">
                              Options <Tooltip text="Number of choices per question (4 = A-D, 5 = A-E)." />
                           </label>
                           <select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold"
                                   value={config.opt} onChange={e=>setConfig({...config, opt: e.target.value})}>
                              <option value="4">4 Options</option>
                              <option value="5">5 Options</option>
                           </select>
                        </div>
                     </div>

                     <div className="p-4 bg-blue-50/50 rounded-xl border border-blue-100 grid grid-cols-3 gap-4">
                        <div>
                           <label className="block text-[10px] font-bold text-slate-400 uppercase mb-1">
                              Time (Min) <Tooltip text="Total duration allowed for the exam." />
                           </label>
                           <input type="number" className="w-full p-2 bg-white border border-blue-100 rounded-lg text-center font-bold text-slate-700" 
                                  value={config.time} onChange={e=>setConfig({...config, time: e.target.value})}/>
                        </div>
                        <div>
                           <label className="block text-[10px] font-bold text-green-600 uppercase mb-1">
                              Correct (+) <Tooltip text="Marks awarded for every correct answer." />
                           </label>
                           <input type="number" className="w-full p-2 bg-white border border-green-200 rounded-lg text-center font-bold text-green-700" 
                                  value={config.pos} onChange={e=>setConfig({...config, pos: e.target.value})}/>
                        </div>
                        <div>
                           <label className="block text-[10px] font-bold text-rose-600 uppercase mb-1">
                              Wrong (-) <Tooltip text="Marks deducted for every incorrect answer (negative marking)." />
                           </label>
                           <input type="number" className="w-full p-2 bg-white border border-rose-200 rounded-lg text-center font-bold text-rose-700" 
                                  value={config.neg} onChange={e=>setConfig({...config, neg: e.target.value})}/>
                        </div>
                     </div>

                     <Button onClick={handleStart} className="w-full mt-4">
                        Start Exam Session <Icons.ChevronRight size={18} />
                     </Button>
                  </div>
               </Card>
            ) : (
               <AnalyticsScreen savedResults={savedResults} />
            )}
          </div>
        );
      };

      // 1.1 ANALYTICS SCREEN
      const AnalyticsScreen = ({ savedResults }) => {
         const uniqueExams = useMemo(() => [...new Set(savedResults.map(r => r.examName))].sort(), [savedResults]);
         const [selected, setSelected] = useState(uniqueExams[0] || '');
         const [chartMode, setChartMode] = useState('score'); // 'score' or 'time'

         const data = useMemo(() => {
            if (!selected) return [];
            return savedResults.filter(r => r.examName === selected).sort((a,b) => a.timestamp - b.timestamp);
         }, [selected, savedResults]);

         // Mistake Heatmap
         const mistakes = useMemo(() => {
            const counts = {};
            data.forEach(d => (d.mistakes || []).forEach(q => counts[q] = (counts[q] || 0) + 1));
            return Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 6);
         }, [data]);

         const avgSpeed = data.length ? Math.round(data.reduce((acc, curr) => acc + (curr.totalQuestions / (curr.timeTakenSeconds/60)), 0) / data.length) : 0;

         if(!uniqueExams.length) return <div className="text-center py-20 text-slate-400">No data found. Take an exam first!</div>;

         return (
            <div className="space-y-6 max-w-4xl mx-auto fade-enter">
               <div className="flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-slate-800">Performance Hub</h2>
                  <select className="p-2 px-4 rounded-xl bg-white border border-slate-300 font-bold text-sm" 
                          value={selected} onChange={e => setSelected(e.target.value)}>
                     {uniqueExams.map(n => <option key={n} value={n}>{n}</option>)}
                  </select>
               </div>

               <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                   <Card className="flex flex-col items-center justify-center py-6 border-l-4 border-l-blue-500">
                      <span className="text-xs font-bold text-slate-400 uppercase">Total Attempts</span>
                      <span className="text-3xl font-extrabold text-slate-800 mt-1">{data.length}</span>
                   </Card>
                   <Card className="flex flex-col items-center justify-center py-6 border-l-4 border-l-purple-500">
                      <span className="text-xs font-bold text-slate-400 uppercase flex items-center gap-1">Avg Speed <Tooltip text="Average number of questions you solve per minute." /></span>
                      <span className="text-3xl font-extrabold text-purple-600 mt-1">{avgSpeed} <span className="text-sm font-medium text-slate-400">Q/min</span></span>
                   </Card>
                   <Card className="flex flex-col items-center justify-center py-6 border-l-4 border-l-green-500">
                      <span className="text-xs font-bold text-slate-400 uppercase">Best Score</span>
                      <span className="text-3xl font-extrabold text-green-600 mt-1">{Math.max(...data.map(d=>d.score))}</span>
                   </Card>
               </div>

               <div className="grid md:grid-cols-2 gap-6">
                  {/* CHART CARD */}
                  <Card className="col-span-1 md:col-span-2">
                     <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-slate-700 flex items-center gap-2">
                           <Icons.Zap size={18} className={chartMode === 'score' ? 'text-blue-500' : 'text-orange-500'} /> 
                           {chartMode === 'score' ? 'Score Trend' : 'Exam Duration Trend'}
                        </h3>
                        <div className="bg-slate-100 p-1 rounded-lg flex text-xs font-bold">
                           <button onClick={()=>setChartMode('score')} className={`px-3 py-1 rounded-md transition ${chartMode==='score' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>Score</button>
                           <button onClick={()=>setChartMode('time')} className={`px-3 py-1 rounded-md transition ${chartMode==='time' ? 'bg-white shadow text-orange-600' : 'text-slate-500'}`}>Time</button>
                        </div>
                     </div>
                     <LineChart 
                        data={data} 
                        dataKey={chartMode === 'score' ? 'score' : 'timeTakenSeconds'} 
                        color={chartMode === 'score' ? '#3b82f6' : '#f97316'} 
                        label={chartMode}
                     />
                  </Card>

                  {/* MISTAKE HEATMAP */}
                  <Card className="border-rose-100 bg-rose-50/30">
                     <h3 className="font-bold text-rose-800 mb-4 flex items-center gap-2">
                        <Icons.AlertTriangle size={18}/> Problem Areas
                        <Tooltip text="These are the specific Question Numbers you got wrong most frequently across all attempts." />
                     </h3>
                     {mistakes.length > 0 ? (
                        <div className="space-y-3">
                           {mistakes.map(([q, count], idx) => (
                              <div key={q} className="flex items-center justify-between bg-white p-3 rounded-xl border border-rose-100 shadow-sm">
                                 <div className="flex items-center gap-3">
                                    <span className="w-6 h-6 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center text-xs font-bold">#{idx+1}</span>
                                    <span className="font-bold text-slate-700">Question {q}</span>
                                 </div>
                                 <div className="text-xs font-bold text-rose-500">{count} mistakes</div>
                              </div>
                           ))}
                        </div>
                     ) : (
                        <p className="text-sm text-slate-500 italic">No recurring mistakes found yet. Good job!</p>
                     )}
                  </Card>
                  
                  {/* TIME INSIGHT */}
                  <Card>
                     <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><Icons.Timer size={18}/> Time Management</h3>
                     <div className="text-sm text-slate-600 space-y-2">
                        <p>Latest Exam Time: <strong>{Math.floor(data[data.length-1].timeTakenSeconds/60)}m {data[data.length-1].timeTakenSeconds%60}s</strong></p>
                        <p>Avg Time per Q: <strong>{data[data.length-1].avgTimePerQ} sec</strong></p>
                        <div className="mt-4 pt-4 border-t border-slate-100 text-xs text-slate-400">
                           Tip: {data[data.length-1].avgTimePerQ < 30 ? "You're solving very fast! Check accuracy." : "Good pacing. Keep it consistent."}
                        </div>
                     </div>
                  </Card>
               </div>
            </div>
         );
      };

      // 2. EXAM SCREEN
      const ExamScreen = ({ config, onFinish }) => {
        const [answers, setAnswers] = useState(Array(parseInt(config.q)).fill(null));
        const [timeLeft, setTimeLeft] = useState(config.time * 60);
        const [startTime] = useState(Date.now());

        useEffect(() => {
          const t = setInterval(() => {
            setTimeLeft(prev => {
              if (prev <= 1) { clearInterval(t); handleSubmit(); return 0; }
              return prev - 1;
            });
          }, 1000);
          return () => clearInterval(t);
        }, []);

        const handleSubmit = () => {
           const timeTaken = config.time * 60 - timeLeft; // Calculate actual time used
           onFinish(answers, timeTaken);
        };

        const toggle = (qIdx, optIdx) => {
           const newAns = [...answers];
           newAns[qIdx] = newAns[qIdx] === optIdx ? null : optIdx;
           setAnswers(newAns);
        };

        const formatTime = (s) => {
           const m = Math.floor(s/60).toString().padStart(2, '0');
           const sec = (s%60).toString().padStart(2, '0');
           return `${m}:${sec}`;
        };

        return (
           <div className="h-screen flex flex-col fade-enter">
              {/* HEADER */}
              <header className="bg-white/90 backdrop-blur-md shadow-sm border-b border-slate-200 p-4 flex justify-between items-center sticky top-0 z-30">
                 <div>
                    <h2 className="font-bold text-slate-800 text-lg">{config.name}</h2>
                    <p className="text-xs text-slate-500 font-medium">{answers.filter(a=>a!==null).length} of {config.q} Answered</p>
                 </div>
                 <div className={`px-4 py-2 rounded-xl font-mono text-xl font-bold transition-colors ${timeLeft < 300 ? 'bg-rose-100 text-rose-600 animate-pulse' : 'bg-slate-100 text-slate-700'}`}>
                    {formatTime(timeLeft)}
                 </div>
              </header>

              {/* OMR SHEET */}
              <div className="flex-1 overflow-y-auto p-4 md:p-8">
                 <div className="max-w-3xl mx-auto space-y-3">
                    {answers.map((ans, qIdx) => (
                       <div key={qIdx} className="bg-white p-3 md:p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center justify-between hover:shadow-md transition-shadow">
                          <span className="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 font-bold text-sm">
                             {qIdx + 1}
                          </span>
                          
                          <div className="flex gap-3 md:gap-6">
                             {OMR_OPTIONS.slice(0, config.opt).map((opt, oIdx) => (
                                <button
                                   key={oIdx}
                                   onClick={() => toggle(qIdx, oIdx)}
                                   className={`w-10 h-10 md:w-12 md:h-12 rounded-full border-2 flex items-center justify-center font-bold text-sm transition-all transform active:scale-90 ${
                                      ans === oIdx 
                                      ? 'bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200 scale-105' 
                                      : 'bg-white border-slate-200 text-slate-400 hover:border-blue-300 hover:bg-blue-50'
                                   }`}
                                >
                                   {opt}
                                </button>
                             ))}
                          </div>
                       </div>
                    ))}
                 </div>
              </div>

              {/* FOOTER */}
              <footer className="p-4 bg-white border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-30">
                 <div className="max-w-3xl mx-auto">
                    <Button onClick={handleSubmit} className="w-full">
                       Submit Exam Now
                    </Button>
                 </div>
              </footer>
           </div>
        );
      };

      // 3. CORRECTION SCREEN
      const CorrectionScreen = ({ config, answers, onDone }) => {
         const [key, setKey] = useState(Array(parseInt(config.q)).fill('unmarked'));

         const handleMark = (idx, status) => {
            const newKey = [...key];
            newKey[idx] = newKey[idx] === status ? 'unmarked' : status;
            setKey(newKey);
         };

         const finalize = () => {
            const attemptedIndices = answers.map((a, i) => a !== null ? i : -1).filter(i => i !== -1);
            const allMarked = attemptedIndices.every(i => key[i] !== 'unmarked');
            if(!allMarked) return alert("Please mark all your ATTEMPTED answers as Correct or Incorrect.");
            onDone(key);
         };

         return (
            <div className="h-screen flex flex-col bg-slate-50 fade-enter">
               <header className="bg-white p-4 shadow-sm border-b border-slate-200 flex justify-between items-center z-30">
                  <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                     <Icons.Check size={20} className="text-green-500"/> Manual Correction
                  </h2>
                  <Button onClick={finalize} variant="success" className="px-4 py-2 text-sm">Finish Grading</Button>
               </header>

               <div className="flex-1 overflow-y-auto p-4 md:p-8">
                  <div className="max-w-3xl mx-auto space-y-3">
                     <div className="bg-orange-50 border border-orange-200 p-4 rounded-xl text-orange-800 text-sm font-medium flex gap-3 items-start">
                        <Icons.Info className="shrink-0 mt-0.5"/>
                        <p>Compare your OMR sheet with the official Answer Key. Mark attempted questions as Correct or Incorrect. Unattempted questions are auto-graded as 0.</p>
                     </div>

                     {answers.map((ans, i) => {
                        const attempted = ans !== null;
                        const status = key[i];
                        return (
                           <div key={i} className={`flex items-center justify-between p-3 rounded-xl border transition-all ${attempted ? 'bg-white border-slate-200' : 'bg-slate-100 border-transparent opacity-60'}`}>
                              <div className="flex items-center gap-4">
                                 <span className="text-slate-400 font-bold text-sm">Q{i+1}</span>
                                 <div className="flex flex-col">
                                    <span className="text-[10px] uppercase font-bold text-slate-400">Your Answer</span>
                                    <span className={`font-bold text-lg ${attempted ? 'text-blue-600' : 'text-slate-400 italic'}`}>
                                       {attempted ? OMR_OPTIONS[ans] : 'Skipped'}
                                    </span>
                                 </div>
                              </div>
                              
                              {attempted && (
                                 <div className="flex gap-2">
                                    <button onClick={()=>handleMark(i, 'correct')} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all ${status==='correct' ? 'bg-green-500 text-white shadow-lg shadow-green-200' : 'bg-slate-100 text-slate-300 hover:bg-green-100 hover:text-green-500'}`}>
                                       <Icons.Check size={20}/>
                                    </button>
                                    <button onClick={()=>handleMark(i, 'incorrect')} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all ${status==='incorrect' ? 'bg-rose-500 text-white shadow-lg shadow-rose-200' : 'bg-slate-100 text-slate-300 hover:bg-rose-100 hover:text-rose-500'}`}>
                                       <Icons.X size={20}/>
                                    </button>
                                 </div>
                              )}
                           </div>
                        )
                     })}
                  </div>
               </div>
            </div>
         );
      };

      // 4. RESULT SCREEN
      const ResultScreen = ({ result, onHome }) => {
         const { score, correct, incorrect, unattempted, accuracy, timeTakenSeconds } = result;
         
         return (
            <div className="max-w-2xl mx-auto px-4 py-10 fade-enter">
               <Card className="overflow-hidden border-0 shadow-2xl p-0">
                  <div className="bg-gradient-to-br from-blue-600 to-indigo-700 p-10 text-center text-white relative">
                     <div className="relative z-10">
                        <h2 className="text-sm font-bold uppercase tracking-widest opacity-80 mb-2">Final Score</h2>
                        <h1 className="text-7xl font-extrabold mb-2">{score}</h1>
                        <p className="opacity-90 font-medium">Accuracy: {accuracy}%</p>
                     </div>
                     {/* Decorative Circles */}
                     <div className="absolute top-0 left-0 w-32 h-32 bg-white opacity-10 rounded-full -translate-x-10 -translate-y-10"></div>
                     <div className="absolute bottom-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full translate-x-10 translate-y-10"></div>
                  </div>

                  <div className="p-8">
                     <div className="grid grid-cols-3 gap-4 mb-8">
                        <div className="bg-green-50 p-4 rounded-2xl border border-green-100 text-center">
                           <div className="text-2xl font-bold text-green-600">{correct}</div>
                           <div className="text-[10px] font-bold text-green-400 uppercase">Correct</div>
                        </div>
                        <div className="bg-rose-50 p-4 rounded-2xl border border-rose-100 text-center">
                           <div className="text-2xl font-bold text-rose-600">{incorrect}</div>
                           <div className="text-[10px] font-bold text-rose-400 uppercase">Wrong</div>
                        </div>
                        <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                           <div className="text-2xl font-bold text-slate-600">{unattempted}</div>
                           <div className="text-[10px] font-bold text-slate-400 uppercase">Skipped</div>
                        </div>
                     </div>
                     
                     <div className="bg-blue-50 rounded-xl p-4 flex justify-between items-center mb-8 border border-blue-100">
                        <div className="flex items-center gap-3">
                           <div className="bg-blue-200 p-2 rounded-lg text-blue-700"><Icons.Clock size={20}/></div>
                           <div>
                              <div className="text-xs font-bold text-blue-400 uppercase">Time Taken</div>
                              <div className="font-bold text-blue-900">{Math.floor(timeTakenSeconds/60)}m {timeTakenSeconds%60}s</div>
                           </div>
                        </div>
                        <div className="text-right">
                           <div className="text-xs font-bold text-blue-400 uppercase">Speed</div>
                           <div className="font-bold text-blue-900">{result.avgTimePerQ}s / Q</div>
                        </div>
                     </div>

                     <Button onClick={onHome} className="w-full">Back to Dashboard</Button>
                  </div>
               </Card>
            </div>
         );
      };

      // --- MAIN FOOTER ---
      const Footer = () => (
         <footer className="mt-auto py-8 bg-white border-t border-slate-200">
            <div className="max-w-5xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
               <div className="text-center md:text-left">
                  <h3 className="font-bold text-slate-800">Designed by Urfa Hasan Fattah</h3>
                  <p className="text-xs text-slate-500 mt-1">Â© {new Date().getFullYear()} OMR Master Pro. All rights reserved.</p>
               </div>
               <div className="flex gap-4">
                  <a href="#" className="flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-full text-xs font-bold hover:bg-blue-100 transition">
                     <Icons.Facebook size={14} /> Facebook
                  </a>
                  <a href="#" className="flex items-center gap-2 px-4 py-2 bg-sky-50 text-sky-600 rounded-full text-xs font-bold hover:bg-sky-100 transition">
                     <Icons.Send size={14} /> Telegram
                  </a>
               </div>
            </div>
         </footer>
      );

      // --- APP ROOT ---
      function App() {
         const [view, setView] = useState('setup');
         const [data, setData] = useState({});
         const [savedResults, setSavedResults] = useState(loadResults());

         const nav = (v, d={}) => { setView(v); setData(prev => ({...prev, ...d})); };

         const startExam = (config) => nav('exam', { config });
         
         const finishExam = (answers, timeTaken) => nav('correction', { answers, timeTaken });
         
         const completeCorrection = (key) => {
            const result = calculateScore(data.answers, key, data.config.pos, data.config.neg, data.timeTaken);
            const final = { 
               ...result, 
               examName: data.config.name, 
               timestamp: Date.now(), 
               config: data.config 
            };
            
            const newHistory = [...savedResults, final];
            setSavedResults(newHistory);
            saveResults(newHistory);
            nav('result', { result: final });
         };

         return (
            <div className="min-h-screen flex flex-col">
               <div className="flex-1 w-full pt-4 pb-20">
                  {view === 'setup' && <SetupScreen onStart={startExam} savedResults={savedResults} />}
                  {view === 'exam' && <ExamScreen config={data.config} onFinish={finishExam} />}
                  {view === 'correction' && <CorrectionScreen config={data.config} answers={data.answers} onDone={completeCorrection} />}
                  {view === 'result' && <ResultScreen result={data.result} onHome={() => setView('setup')} />}
               </div>
               {view === 'setup' && <Footer />}
            </div>
         );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
